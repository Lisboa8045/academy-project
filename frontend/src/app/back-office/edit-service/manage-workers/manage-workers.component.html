<table>
  <tr>
    <td>Name\Permissions</td>
    <th id="permissions-header" *ngFor="let perm of allPermissions;">{{ getProviderPermissionEnumLabel(perm) }}</th>
  </tr>
  @for (provider of serviceProviders(); track provider.id) {
    <tr>
      <td>{{ provider.memberName }}</td>

      @for (permission of allPermissions; track permission) {
        <td>
          <input type="checkbox"
                 [checked]="provider.permissions.includes(permission)"
                 (change)="togglePermission(provider, permission)"
                 [attr.disabled]="isCheckboxDisabled(provider, permission) ? 'true' : null">
        </td>
      }
      <div class="icons-container">
        <fa-icon *ngIf="userHasPermission(ProviderPermissionEnumModel.UPDATE_PERMISSIONS) && !provider.permissions.includes(ProviderPermissionEnumModel.OWNER)" [icon]="faFloppyDisk" class="update-icon" (click)="updatePermissions(provider)">
        </fa-icon>
        <fa-icon *ngIf="userHasPermission(ProviderPermissionEnumModel.ADD_SERVICE_PROVIDER) && !provider.permissions.includes(ProviderPermissionEnumModel.OWNER)" [icon]="faTrash" class="remove-icon" (click)="removeServiceProvider(provider)">
        </fa-icon>
      </div>
    </tr>
  }
</table>
<div *ngIf="userHasPermission(ProviderPermissionEnumModel.ADD_SERVICE_PROVIDER)">
  <input type="text" id="name"
         [ngModel]="searchTerm | async"
         (ngModelChange)="searchTerm.next($event)"
         class="search-input" [ngClass]="selectedWorker() ? 'is-selected' : ''"
         placeholder="Search For New Worker"/>
  <button type="button" (click)="addWorker()">Add Worker</button>

  <ul class="new-workers-list" *ngIf="newWorkers && !selectedWorker()">
      @if (newWorkers.length <= 0) {
        <li class="worker-item">No workers match query</li>
      } @else {
      <li *ngFor="let worker of newWorkers" class="worker-item" (click)="selectWorker(worker)">
        <strong>{{worker.username}}</strong>
      </li>
      }
  </ul>
</div>


