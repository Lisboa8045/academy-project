<div class="schedule-container">
  <h2>Agendar Marcação</h2>

  <!-- Pesquisa e filtro -->
  <div *ngIf="currentStep === 'service' && serviceTypes.length > 0">
    <div class="search-bar">
      <input type="text" placeholder="Procurar serviços..." (input)="onSearchChange($event)" />
    </div>

    <div class="service-type-scroll">
      <button
        class="type-button"
        [class.active]="!selectedServiceTypeId"
        (click)="filterByType(null)">
        Todos
      </button>
      <button
        *ngFor="let type of serviceTypes"
        class="type-button"
        [class.active]="selectedServiceTypeId === type.id"
        (click)="filterByType(type.id)">
        {{ type.name }}
      </button>
    </div>
  </div>

  <!-- Lista de serviços (filtrados) -->
  <div *ngIf="currentStep === 'service' && filteredServices.length > 0">
    <h3>Escolher serviço</h3>
    <ul>
      <li *ngFor="let s of filteredServices"
          (click)="selectService(s)"
          [class.selected]="s.id === form.get('serviceId')?.value">
        {{ s.name }} - {{ s.description }} - {{ s.price }}€ - {{ s.serviceTypeId }}
      </li>
    </ul>
  </div>

  <!-- Passo 2: Slots -->
  <div *ngIf="currentStep === 'slots' && slots.length > 0">
    <h3>Escolher horário</h3>
    <ul>
      <li *ngFor="let slot of slots"
          (click)="selectSlot(slot)"
          [class.selected]="slot === selectedSlot">
        {{ slot.start | date:'short' }} - {{ slot.providerName }}
      </li>
    </ul>
    <button (click)="currentStep = 'service'">Voltar a serviços</button>
  </div>
</div>

<!-- Modal de confirmação -->
<div class="modal-backdrop" *ngIf="currentStep === 'confirmation' && showConfirmationModal">
  <div class="modal">
    <h3>Confirmar Marcação</h3>
    <p><strong>Serviço:</strong> {{ selectedService?.name }}</p>
    <p><strong>Data:</strong> {{ selectedSlot?.start | date:'short' }}</p>
    <p><strong>Prestador:</strong> {{ selectedSlot?.providerName }}</p>

    <div class="modal-buttons">
      <button (click)="cancelModal()">Cancelar</button>
      <button (click)="confirmInModal()">Confirmar</button>
    </div>
  </div>
</div>
